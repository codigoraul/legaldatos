---
// Detectar si estamos en la página principal
const isHomePage = Astro.url.pathname === '/' || Astro.url.pathname === '/prueba/' || Astro.url.pathname.endsWith('/index.html');

// Detectar si estamos en desarrollo o producción
const isDev = import.meta.env.DEV;
const basePath = isDev ? '' : '/prueba';

// Links de navegación según entorno
const nav = [
	{ href: `${basePath}/`, label: 'Inicio' },
	{ href: `${basePath}/nosotros/`, label: 'Nosotros' },
	{ href: `${basePath}/servicios/`, label: 'Servicios' },
	{ href: `${basePath}/publicaciones/`, label: 'Publicaciones' },
	{ href: `${basePath}/contacto/`, label: 'Contacto' },
];

const pathname = Astro.url.pathname;

const menuButtonId = 'mobile-menu-button';
const menuPanelId = 'mobile-menu-panel';
---

<header class="site-header">
	<div class="container header-inner">
		<a class="brand" href={`${basePath}/`} aria-label="LegalDatos">
			
			<img src={`${basePath}logo-legaldatos.png`} width="136"  alt="LegalDatos" />
		</a>

		<nav class="nav" aria-label="Navegación principal">
			{nav.map((item) => (
				<a class:list={["nav-link", pathname === item.href && "is-active"]} href={item.href}>
					{item.label}
				</a>
			))}
		</nav>

		<button
			id={menuButtonId}
			type="button"
			class="menu-button"
			aria-label="Abrir menú"
			aria-controls={menuPanelId}
			aria-expanded="false"
		>
			<span class="menu-icon" aria-hidden="true"></span>
		</button>
	</div>

	<div id={menuPanelId} class="mobile-panel" hidden>
		<div class="container mobile-panel-inner">
			<nav class="mobile-nav" aria-label="Navegación móvil">
				{nav.map((item) => (
					<a class:list={["mobile-link", pathname === item.href && "is-active"]} href={item.href}>
						{item.label}
					</a>
				))}
			</nav>
		</div>
	</div>
</header>

<script>
	const btn = document.getElementById('mobile-menu-button');
	const panel = document.getElementById('mobile-menu-panel');
	if (btn && panel) {
		const close = () => {
			btn.setAttribute('aria-expanded', 'false');
			panel.setAttribute('hidden', '');
		};
		const open = () => {
			btn.setAttribute('aria-expanded', 'true');
			panel.removeAttribute('hidden');
		};
		btn.addEventListener('click', () => {
			const expanded = btn.getAttribute('aria-expanded') === 'true';
			expanded ? close() : open();
		});
		panel.addEventListener('click', (e) => {
			const el = e.target;
			if (el instanceof Element && el.tagName === 'A') close();
		});
		document.addEventListener('keydown', (e) => {
			if (e.key === 'Escape') close();
		});
	}
</script>

<style>
	.site-header {
		position: sticky;
		top: 0;
		z-index: 50;
		background: var(--primary);
		border-bottom: 1px solid rgba(255, 255, 255, 0.12);
	}

	.header-inner {
		display: flex;
		align-items: center;
		justify-content: space-between;
		gap: 16px;
		height: 72px;
	}

	.brand {
		display: inline-flex;
		align-items: center;
		gap: 10px;
		text-decoration: none;
		color: rgba(255, 255, 255, 0.95);
		font-weight: 700;
		letter-spacing: -0.02em;
	}

	.brand-mark {
		display: inline-flex;
		align-items: center;
		justify-content: center;
		width: 36px;
		height: 36px;
		border-radius: 10px;
		background: rgba(34, 211, 238, 0.16);
		border: 1px solid rgba(34, 211, 238, 0.25);
		color: white;
		font-size: 14px;
	}

	.brand-text {
		font-size: 16px;
	}

	.nav {
		display: flex;
		align-items: center;
		gap: 14px;
		flex-wrap: wrap;
		justify-content: flex-end;
	}

	.nav-link {
		text-decoration: none;
		color: rgba(255, 255, 255, 0.92);
		font-weight: 600;
		font-size: 16px;
		padding: 10px 6px;
		border-radius: 0;
		position: relative;
		transition:
			color 160ms ease,
			opacity 160ms ease;
	}

	.nav-link::after {
		content: '';
		position: absolute;
		left: 6px;
		right: 6px;
		bottom: 6px;
		height: 2px;
		border-radius: 999px;
		background: var(--accent);
		transform: scaleX(0);
		transform-origin: center;
		opacity: 0;
		transition: transform 180ms ease, opacity 180ms ease;
	}

	.nav-link:hover {
		color: rgba(255, 255, 255, 0.98);
	}

	.nav-link:hover::after {
		transform: scaleX(1);
		opacity: 1;
	}

	.nav-link.is-active {
		color: rgba(255, 255, 255, 0.98);
	}

	.nav-link.is-active::after {
		transform: scaleX(1);
		opacity: 1;
	}

	.cta {
		background: var(--accent);
		color: #06131f;
		box-shadow: 0 10px 28px rgba(34, 211, 238, 0.25);
	}

	.cta:hover {
		box-shadow: 0 16px 40px rgba(34, 211, 238, 0.32);
	}

	.cta {
		white-space: nowrap;
		border-color: rgba(34, 211, 238, 0.35);
	}

	.menu-button {
		display: none;
		align-items: center;
		justify-content: center;
		width: 44px;
		height: 44px;
		border-radius: 12px;
		border: 1px solid rgba(255, 255, 255, 0.18);
		background: rgba(255, 255, 255, 0.08);
		color: rgba(255, 255, 255, 0.92);
		cursor: pointer;
	}

	.menu-button:hover {
		background: rgba(34, 211, 238, 0.14);
		border-color: rgba(34, 211, 238, 0.28);
	}

	.menu-icon {
		position: relative;
		width: 18px;
		height: 2px;
		background: currentColor;
		display: block;
	}

	.menu-icon::before,
	.menu-icon::after {
		content: '';
		position: absolute;
		left: 0;
		width: 18px;
		height: 2px;
		background: currentColor;
	}

	.menu-icon::before {
		top: -6px;
	}

	.menu-icon::after {
		top: 6px;
	}

	.mobile-panel {
		border-top: 1px solid rgba(255, 255, 255, 0.12);
		background: rgba(42, 55, 85, 0.98);
	}

	.mobile-panel-inner {
		padding-top: 14px;
		padding-bottom: 18px;
		display: grid;
		gap: 12px;
	}

	.mobile-nav {
		display: grid;
		gap: 0;
	}

	.mobile-link {
		display: flex;
		align-items: center;
		justify-content: space-between;
		padding: 14px 2px;
		text-decoration: none;
		color: rgba(255, 255, 255, 0.9);
		font-weight: 650;
		letter-spacing: -0.01em;
		background: transparent;
		border: 0;
		border-bottom: 1px solid rgba(255, 255, 255, 0.10);
	}

	.mobile-link:last-child {
		border-bottom: 0;
	}

	.mobile-link:hover {
		color: rgba(255, 255, 255, 1);
	}

	.mobile-link.is-active {
		color: rgba(255, 255, 255, 1);
		border-bottom-color: rgba(34, 211, 238, 0.35);
	}

	@media (max-width: 720px) {
		.header-inner {
			height: auto;
			padding-top: 10px;
			padding-bottom: 10px;
			align-items: flex-start;
		}

		.nav {
			display: none;
		}

		.menu-button {
			display: inline-flex;
		}
	}
</style>
